<html>
 <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script defer src="https://www.gstatic.com/firebasejs/8.0.1/firebase-app.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.0.1/firebase-analytics.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.0.1/firebase-auth.js"></script>
    <script defer src="/cdn/js/init-firebase.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <title>{{pageTitle}}</title>

  </head>
  <body>

      <nav class="navbar navbar-dark sticky-top shadow" style="background-color: #430E13;">
    <!-- Navbar content -->

  <a class="navbar-brand" href="#">
    Aktiv
  </a>

    </nav>

    <div class="container" style="padding:20px">

    <div class="row">

        <div class="col card card-body bg-light non-rounded non-bordered">

        <h1>{{pageTitle}}</h1>

        <div class="container">

        <div class="row">

        <div class="col text-center">
        <button onClick="signIn()" class="btn btn-outline-success my-4">Sign In</button>
        </div>
        <div class="col text-center">
        <button onClick="sendRequest()" class="btn btn-outline-info my-4">Send Request</button>
        </div>
        <div class="col text-center">
        <button onClick="signOut()" class="btn btn-outline-danger my-4">Sign Out</button>
        </div>

</div>

<div class="row">

<div class="col text-center">

        <p class="lead" id="response">No data yet...</p>

        </div>
<div class="col text-center">

        <p class="lead" id="auth">Unauthorized</p>
                </div>

        </div>

        </div>

        <script>

    function signIn() {
      firebase.auth()
      .signInWithEmailAndPassword("dummy@gmail.com", "pass123!")
      .then(() => {
        document.getElementById('auth').innerHTML = 'Authorized'
      }).catch((err) => {
        document.getElementById('auth').innerHTML = err
      })
    }

    function signOut() {
      firebase.auth().signOut().then(() => {
        document.getElementById('auth').innerHTML = 'Unauthorized'
      }).catch((err) => {
        document.getElementById('auth').innerHTML = err
      })
    }

        function sendRequest () {

const client = axios.create({
  baseURL: 'http://localhost:3000',
  json: true
})

      if (firebase.auth().currentUser) {
        firebase.auth().currentUser.getIdToken(true)
        .then((idToken) => {
          client({
            method: 'get',
            url: '/ping',
            headers: {
              'AuthToken': idToken
            }
          }).then((res) => {
            document.getElementById('response').innerHTML = res.data.message
          }).catch((error) => {
            document.getElementById('response').innerHTML = error
          })
        }).catch((error) => {
          document.getElementById('response').innerHTML = "Error getting auth token"
        });
      } else {
        client({
          method: 'get',
          url: '/ping'
        }).then((res) => {
          document.getElementById('response').innerHTML = res.data.message
        }).catch((error) => {
          document.getElementById('response').innerHTML = error
        })
      }

        }

        </script>

    </>

    </div>

  </div>

    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@100;300;400;500;600;700;900&display=swap" rel="stylesheet">
    <link href="/cdn/css/site.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>   

 </body>
</html>
